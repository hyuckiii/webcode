<!doctype html>
<html lang="ko">
<head>
<title>로스트킹덤 - 마블</title>
<meta charset="utf-8">
<meta id="viewport" name="viewport" content="width=980,user-scalable=yes">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="css/style.css" />
<script src="https://static.four33.com/event/common/js/jquery-1.8.1.min.js"></script>
</head>
<body>
<div id="fWrap">

  <div id="header"></div>
  <!-- // #header -->

  <div id="container">
    <div id="quest1">
      <div id="questMap">
        <div class="top">
          <div class="wrap_map">
            <div class="btn_quest0 map active" data-step="0" data-reward="보상아이템명0"><span class="bg"></span></div>
            <div class="btn_quest1 map" data-step="1" data-reward="보상아이템명1"><span class="bg"></span></div>
            <div class="btn_quest2 map" data-step="2" data-reward="보상아이템명2"><span class="bg"></span></div>
            <div class="btn_quest3 map" data-step="3" data-reward="보상아이템명3"><span class="bg"></span></div>
            <div class="btn_quest4 map" data-step="4" data-reward="보상아이템명4"><span class="bg"></span></div>
          </div>
        </div>
        <div class="r_side">
          <div class="wrap_map">
            <div class="btn_quest5 map" data-step="5" data-reward="보상아이템명5"><span class="bg"></span></div>
            <div class="btn_quest6 map" data-step="6" data-reward="보상아이템명6"><span class="bg"></span></div>
            <div class="btn_quest7 map" data-step="7" data-reward="보상아이템명7"><span class="bg"></span></div>
          </div>
        </div>
        <div class="bottom">
          <div class="wrap_map">
            <div class="btn_quest8 map" data-step="8" data-reward="보상아이템명8"><span class="bg"></span></div>
            <div class="btn_quest9 map" data-step="9" data-reward="보상아이템명9"><span class="bg"></span></div>
            <div class="btn_quest10 map" data-step="10" data-reward="보상아이템명10"><span class="bg"></span></div>
            <div class="btn_quest11 map" data-step="11" data-reward="보상아이템명11"><span class="bg"></span></div>
            <div class="btn_quest12 map" data-step="12" data-reward="보상아이템명12"><span class="bg"></span></div>
          </div>
        </div>
        <div class="l_side">
          <div class="wrap_map">
            <div class="btn_quest13 map" data-step="13" data-reward="보상아이템명13"><span class="bg"></span></div>
            <div class="btn_quest14 map" data-step="14" data-reward="보상아이템명14"><span class="bg"></span></div>
            <div class="btn_quest15 map" data-step="15" data-reward="보상아이템명15"><span class="bg"></span></div>
          </div>
        </div>
      </div>
      <!-- // #questMap -->

      <div id="questInfo">
        <div class="status">
          <span class="left_point">999</span> <!-- 잔여 포인트 -->
          <span class="use_point"></span>     <!-- 누적 사용 포인트 -->
          <span class="total_point"></span>   <!-- 누적 획득 포인트 -->
        </div>
        <div class="dice">
          <div class="img_dice">
            <div class="ani"><img src="images/ani-dice-blur.gif" alt="주사위"></div>
            <div class="img"></div>
          </div>
          <button class="btn_dice ready" type="button"></button>
        </div>
      </div>
      <!-- // #questMenu -->
    </div>
    <!-- // #quest1(말판) -->

    <div id="reward">
      <ul>
        <li class="btn_reward0"><span class="btn"></span></li>
        <li class="btn_reward1"><span class="btn"></span></li>
        <li class="btn_reward2"><span class="btn"></span></li>
        <li class="btn_reward3"><span class="btn"></span></li>
        <li class="btn_reward4"><span class="btn"></span></li>
      </ul>
    </div>
    <!-- // #questReward -->

  </div>
  <!-- #container -->

  <div id="fLayer">
    <!-- layer 지급완료 -->
    <div class="layer_alert">
      <div class="wrap_layer">
        <div class="layer_common">
          <div class="msg">
            <div></div>
          </div>
          <div class="btn_area">
            <button class="btn_close btn_comm" type="button"><img src="http://static.four33.co.kr/event/game/lostk/ingame/160623_month4/images/btn-close.png" alt="확인"></button>
          </div>
        </div>
      </div>
    </div>

    <!-- layer BG -->
    <div class="bg_layer"></div>

  </div>
  <!-- // #fLayer -->


</div>
<!-- // #fWrap -->

<!--<script type="text/javascript" src="js/ftt.jquery.marble.1.2.js"></script>-->
<script src="https://static.four33.com/event/common/js/ftt.jquery.marble.1.2.min.js"></script>
<script type="text/javascript">
/****************************

[ ftt.jquery.marble ]

  ( 옵션 )
    샘플 내 var BoardgameData 참고

  ( 초기 위치 지정 )
    $(element).Boardgame({mapSet: startNum});

  ( 게임실행 - 리턴 값 필요 시 변수에 넣어서 사용 )
    $(element).Boardgame( 옵션(object), 돈 바퀴수(number), 참여 횟수(number), 주사위 값(number) )
    EX> var dice = $('#questMap').Boardgame(BoardgameData, 0, diceCount, diceScore);

  ( callback - 옵션 내에 포함 )
    onStart - 버튼 누른 직후(말 굴리기)
    onMove - 말이 이동을 시작하는 시점
    onAfter - 말 이동 후

  ( 리턴 값 )
    data = {
      diceScore: diceScore,                // 주사위 값
      startPos: startPos,                  // 시작위치
      arrivePos: arrivePos,                // 도착위치
      loopNum: loopNum,                    // 전체 바퀴 수
      diceCount: diceCount,                // 주사위를 굴린 총 횟수
      typeMap: typeMap                     // 도착 위치에 이벤트
      reward: 보상명                        // html내 도착 위치의 "data-reward" 값 문자열로 반환
    }

******************************/

var BoardgameData = {
  diceSet: 6,                              // 주사위 단위(1부터)
  pauseStart: 2580,                        // 말 이동시작까지 시간
  pauseMove: 500,                          // 말 이동 시간 간격(1칸당의 시간)
  onStart: function (data) {               // 주사위 굴리기 시작
    $('#questInfo .dice').attr('class','dice loading');
    $('#questInfo .dice .ani img').attr('src','images/ani-dice-blur.gif');
    console.log($('#questMap .map').eq(data.arrivePos).attr('data-step'));
  }, onMove: function (data) {             // 말 이동 시작
    $('#questInfo .dice .ani img').attr('src','');
    $('#questInfo .dice').removeClass('loading').addClass('val'+data.diceScore);
  }, onAfter: function(data){              // 말 이동 종료
    if (1){
      // 정상 획득 시
      console.log($('#questMap .map').eq(data.arrivePos).attr('data-step'));    // 맵 속성 가져오기
      openLayer(data.reward+'<br>'+alertMsg.confirm);
    }else if (0){
      // 에러 발생 시
    }
    //mapEvent(data);
  }
},
leftPoint = 300,                          // 잔여 포인트
usePoint = 222,                           // 누적 사용 포인트
totalPoint = 100,                         // 누적 획득 포인트
rewardStatus = [1, 1, 1, 1, 1],           // 추가보상(주사위 사용횟수 보상) 값(0/1/2)
diceCount = 5,                            // 게임 참여 횟수
diceScore = '6',                          // 주사위 값(수동으로 지정하지 않는 경우 js에서 랜덤 생성)
startNum = 4,                             // 시작 위치(0 ~ n)
limitCount = 10,                          // 참여제한 횟수
alertMsg = {
  confirm: '보상이 우편함으로<br>지급되었습니다.',                        // 정상 지급
  error1: '오류가 발생하였습니다.<br>고객센터로 문의해주시기 바랍니다.',     // 오류 발생
  error2: '정상적인 접근이 아닙니다.<br>고객센터로 문의해주시기 바랍니다.',  // 비정상 참여
  notEnough: '포인트가 부족합니다.'                                      // 포인트 부족
};

// ios check
$(function(){
  if ( /iPhone|iPad|iPod/i.test(navigator.userAgent) ) $("body").addClass("ios")
});

// 말 초기 위치지정
$('#questMap').Boardgame({mapSet: startNum});

// 주사위 굴리기
$('#questInfo .dice').on('click','.btn_dice.ready',function () {
  if ( !$('#questMap').hasClass('disable') ) {
    if ( leftPoint >= 10 ){
      var dice = $('#questMap').Boardgame(BoardgameData, 0, diceCount, diceScore);
      $('#fWrap').removeClass('ready');

      if (typeof(dice) == 'object'){
        leftPoint = leftPoint -10;          // 남은 포인트(1회 실행 시 -10)
        usePoint = dice.diceCount * 10;     // 누적 사용 포인트(게임 참여 횟수 * 10)
        diceCount = dice.diceCount;         // 굴린 주사위 수 갱신
      }
    }else{
      // 포인트 부족
      openLayer(alertMsg.notEnough);
    }
  }else{
    console.log('동작중');
  }
});

function layoutSet(arr) {
  $('#fWrap').addClass('ready');
  $('#questInfo .status .left_point').text(leftPoint);
  $('#questInfo .status .use_point').text(usePoint);
  $('#questInfo .status .total_point').text(totalPoint);

  $('#container #reward li').each(function (i, ele) {
    var rewardType;
    if ( arr[i] == 1 ){
      rewardType = 'ready';
    }else if ( arr[i] == 2 ){
      rewardType = 'end';
    }
    $(ele).removeClass('ready end').addClass(rewardType);
  })
}

layoutSet(rewardStatus);




// func openLayer
function openLayer(msg){
  var target = $('#fLayer .layer_alert'),
  targetHeight = parseInt($(target).css('height')),
  targetMsg = $(target).find('.msg div'),
  winHeight = $(window).height(),
  layerPos = $(window).scrollTop();
  if(target.length){
    layerPos = (winHeight - targetHeight) / 2;
    $('#fLayer').show();
    if(targetHeight < winHeight){ // 레이어가 윈도우보다 크지 않은 경우
      $(target).css('top',layerPos).show();
      $(target).children('.wrap_layer').show();
      // scroll disable
      $(document).bind('touchmove',function(event){
        event.preventDefault();
      });
    }else{
      $(window).scrollTop(0);
      $(target).addClass('nonfix').css('top', 20).show();
    }
  }
  $(targetMsg).html(msg);
}

// closeLayer
$('#fLayer .btn_close, .bg_layer').bind('click',function(){
  var target = $('#fLayer > div:visible').not('.bg_layer');
  $(document).unbind('touchmove');
  $('#fLayer').hide();
  $(target).hide();
  layoutSet([2, 2, 2, 2, 2]);
});

// layer test(확인 후 삭제해주세요)
$('.test button').bind('click',function(){
  var btnName = $(this).attr('class');
  openLayer(btnName);
});


// 추가보상 버튼이 활성화 된 경우
$("#container #reward").on('click','li.ready',function(){
  var btnStatus = $(this).hasClass('ready');
  if(btnStatus){
    /*
     openLayer(layer_confirm) - 지급완료
     openLayer(layer_error1) - 에러
     openLayer(layer_error2) - 에러
     openLayer(layer_error3) - 에러
     */
    openLayer(alertMsg.confirm);
  }else{
    return false;
  }
});

</script>
</body>

</html>