(function(a){a.fn.fortune=function(o){var m=this;var g=o.prize?o.prize:o;var e=o.duration||1000;var d=o.separation||0;var b=Array.isArray(g)?g.length:g;var i=360/b;var l=false;var k=o.min_spins||10;var c=o.max_spins||15;var n=o.onSpinBounce||function(){};var f=true;if(undefined!==o.clockWise){f=o.clockWise}m.spin=function(v,t){if("undefined"==typeof t||t===null){t=-1}var z=1;if(!f){z=-1}v=typeof v==="number"?v:Math.floor(Math.random()*b);var y=a.Deferred();var u=Math.floor(i*(v));if(v<v.length&&undefined!==v[v].length){sub_amount=v[v].length;t=Math.floor(Math.random()*sub_amount);u=Math.floor(i*(v-1/2)+(i/sub_amount)*t+h(d,i/sub_amount-d))}var s=h(k,c);var w=z*(360*s+z*u);var q=0;var p=false;l=true;m.css({transform:"rotate("+w+"deg)","-webkit-transform":"rotate("+w+"deg)",transition:"transform "+e+"ms cubic-bezier(0.215, 0.610, 0.355, 1.000)","-webkit-transition":"-webkit-transform "+e+"ms cubic-bezier(0.215, 0.610, 0.355, 1.000)"}).siblings(".spin").removeClass("bounce");var x=function(){var D=Math.floor(j(m)),B=Math.floor((D+i*0.5)%i),A,E=i/5,C=i/10;q=Math.floor(D<q?q-360*z:q);A=D-q;if((B<E&&A<C)||(B<E*3&&A>=C)){if(!p){m.siblings(".spin").addClass("bounce");n(m.siblings(".spin"));p=true}}else{m.siblings(".spin").removeClass("bounce");p=false}if(l){q=D;requestAnimationFrame(x)}};var r=requestAnimationFrame(x);setTimeout(function(){m.css({transform:"rotate("+u+"deg)","-webkit-transform":"rotate("+u+"deg)",transition:"","-webkit-transition":""}).siblings(".spin").removeClass("bounce");cancelAnimationFrame(r);result=v[v]||v;if(t!=-1){result=v[v][t]}y.resolve(result);l=false},e);return y.promise()};var j=function(u){var v=0,s=u.css("-webkit-transform")||u.css("-moz-transform")||u.css("-ms-transform")||u.css("-o-transform")||u.css("transform");if(s!=="none"){var v,r=s.split("(")[1].split(")")[0].split(","),q=r[0],p=r[1],t=Math.atan2(p,q);if(t<0){t+=(2*Math.PI)}v=Math.round(t*(180/Math.PI))}return v};var h=function(q,p){return Math.floor(Math.random()*(p-q+1))+q};m.getCurrentPosition=function(){return j(m)};return m}})(jQuery);function roulette(d){var c={point:{prize:null,require:null,current:null,use:null,total:null,chance:null},element:{wrap:$("#roulette"),target:$("#roulette .spinner"),btn:$("#roulette .btn_start"),btnMsg:$("#roulette .btn_start span"),currentPoint:$("#roulette .left_point"),usePoint:$("#roulette .use_point"),totalPoint:$("#roulette .total_point"),chance:$("#roulette .chance_point")},options:{separation:0,prize:null,duration:2000,clockWise:false,comma:true,afterLayout:false,resetDelay:0,itemDirection:"right"},callback:{start:function(){return true},done:function(){return true}},msg:{point:function(){return true},chance:function(){return true},ing:function(){return false}}},b=d;function a(f){if(f===null){return null}else{return f.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}function e(f){var g={target:$(f.element.target).fortune(f.options),point:{num:{chance:(f.init!==true&&f.point.chance!=null)?f.point.chance-1:f.point.chance,current:(f.init!==true)?f.point.current-f.point.require:f.point.current,use:(f.init!==true)?f.point.use+f.point.require:f.point.use,total:f.point.total,require:f.point.require,score:f.score},text:{chance:null,current:null,use:null,total:null}},isRun:(f.element.btn.hasClass("disabled"))?true:false};g.point.text={chance:(f.options.comma&&f.point.chance!=null)?a(g.point.num.chance):g.point.num.chance,current:(f.options.comma)?a(g.point.num.current):g.point.num.current,use:(f.options.comma)?a(g.point.num.use):g.point.num.use,total:(f.options.comma)?a(g.point.num.total):g.point.num.total};if(f.init===true){$(f.element.chance).html(g.point.text.chance);$(f.element.currentPoint).html(g.point.text.current);$(f.element.usePoint).html(g.point.text.use);$(f.element.totalPoint).html(g.point.text.total);$(f.element.target).addClass("item"+f.point.lastScore);if(f.point.chance===0||f.point.current-f.point.require<0){$(f.element.btn).addClass("disabled")}}return g}(function(){var f=$.extend(true,{},c,b);f.init=true;e(f)})();this.spin=function(h){var i=$.extend(true,{},c,h);var m=e(i);var f=function(){$(i.element.chance).html(m.point.text.chance);$(i.element.currentPoint).html(m.point.text.current);$(i.element.usePoint).html(m.point.text.use);$(i.element.totalPoint).html(m.point.text.total)},k=$(i.element.btn),j=m.point.num.current>-1,l=m.point.num.chance!==null&&m.point.num.chance>0,g=!m.isRun&&j&&l;score=(i.options.itemDirection=="left")?i.score:i.options.prize-i.score;if(g){(function(){$(k).addClass("disabled");if(!i.options.afterLayout){f()}i.callback.start(m.point.num)})();m.target.spin(score).done(function(){if(i.options.afterLayout){f()}i.callback.done(m.point.num);setTimeout(function(){if(m.point.num.current-i.point.require>-1&&l){$(k).removeClass("disabled")}},i.options.resetDelay)})}else{if(j){i.msg.point()}else{if(l){i.msg.chance()}else{if(!g){i.msg.ing()}}}return false}}};